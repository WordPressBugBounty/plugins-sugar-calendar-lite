var SugarCalendarBlocks=window.SugarCalendarBlocks||{};SugarCalendarBlocks.EventList=SugarCalendarBlocks.EventList||(s=>{function e(e){this.$blockContainer=e,this.$baseContainer=e.find(".sugar-calendar-event-list-block__base-container"),this.controls=new SugarCalendarBlocks.Controls(e),this.$blockContainer.on("block:update",(e,t)=>{this.update(t)}),this.$blockContainer.on("block:filterDisplayedEvents",this.onFilterDisplayedEvents.bind(this)),this.$blockContainer.find(".sugar-calendar-event-list-block__footer__prev_btn").on("click",this.onPreviousWeekBtnClick.bind(this)),this.$blockContainer.find(".sugar-calendar-event-list-block__footer__next_btn").on("click",this.onNextWeekBtnClick.bind(this)),1===parseInt(this.controls.$formContainer.find('input[name="sc_visitor_tz_convert"]').val())&&this.update({})}e.prototype.update=function(e){SugarCalendarBlocks.hideAllPopovers();var t=void 0!==e.update_display&&e.update_display,e=void 0===e.action?"":e.action;let n=parseInt(this.$blockContainer.data("paged"),10)||1;"previous_week"===e?n--:"next_week"===e?n++:n=1;t={attributes:this.$blockContainer.data("attributes"),calendars:this.controls.getCalendarIds(),venues:this.controls.getVenueIds(),speakers:this.controls.getSpeakerIds(),tags:this.controls.getTagIds(),calendarsFilter:this.controls.getCalendarsFilter(),venuesFilter:this.controls.getVenuesFilter(),speakersFilter:this.controls.getSpeakersFilter(),tagsFilter:this.controls.getTagsFilter(),day:parseInt(this.controls.$formContainer.find('input[name="sc_day"]').val()),month:parseInt(this.controls.$formContainer.find('input[name="sc_month"]').val()),year:parseInt(this.controls.$formContainer.find('input[name="sc_year"]').val()),search:this.controls.$searchContainer.val(),display:this.controls.getDisplayMode(),visitor_tz_convert:parseInt(this.controls.$formContainer.find('input[name="sc_visitor_tz_convert"]').val()),visitor_tz:Intl.DateTimeFormat().resolvedOptions().timeZone,updateDisplay:t,paged:n,action:e};let a=this;s.post(sc_frontend_blocks_common_obj.ajax_url,{action:"sugar_calendar_event_list_block_update",block:t,nonce:sc_frontend_blocks_common_obj.nonce},function(e){e.success&&(a.controls.updateDate(e.data.date),a.$blockContainer.find(".sugar-calendar-block__view-heading").text(e.data.heading),a.$blockContainer.find(".sugar-calendar-block__view-heading-mobile").text(e.data.heading_mobile),a.$baseContainer.html(e.data.body),a.$blockContainer.trigger("block:filterDisplayedEvents"),"undefined"!=typeof SCTimeZones&&SCTimeZones.convertEventsTime(),void 0!==e.data.paged&&a.$blockContainer.data("paged",e.data.paged),void 0!==e.data.enable_next&&a.$blockContainer.find(".sugar-calendar-event-list-block__footer__next_btn").prop("disabled",!e.data.enable_next),void 0!==e.data.enable_previous)&&a.$blockContainer.find(".sugar-calendar-event-list-block__footer__prev_btn").prop("disabled",!e.data.enable_previous)})},e.prototype.onFilterDisplayedEvents=function(){let a=this.controls.getTimeOfDay(),o=this.controls.getDaysOfWeek(),e=this.controls.getDisplayMode(),i=!1;this.$blockContainer.find(`.sugar-calendar-event-list-block__${e}view__event`).each((e,t)=>{t=s(t);let n=!0;(0===o.length||0<s(o).filter(t.data("eventdays")).length)&&(0===a.length||0<s(a).filter(t.data("daydiv")).length)&&(n=!1,i=!0),n?t.addClass("sugar-calendar-block-hide-element"):t.removeClass("sugar-calendar-block-hide-element")});var t=this.$baseContainer.find(".sugar-calendar-block__base-container__no-events");i?(this.$baseContainer.find(".sugar-calendar-block__events-display-container").removeClass("sugar-calendar-block-hide-element"),0<t.length&&t.remove()):(this.$baseContainer.find(".sugar-calendar-block__events-display-container").addClass("sugar-calendar-block-hide-element"),0===t.length&&this.$baseContainer.prepend('<div class="sugar-calendar-block__base-container__no-events"><div class="sugar-calendar-block__base-container__no-events__msg">'+SCEventListBlock.strings.no_events_criteria_based+"</div></div>"))},e.prototype.onPreviousWeekBtnClick=function(){this.update({action:"previous_week"})},e.prototype.onNextWeekBtnClick=function(){this.update({action:"next_week"})};let t={init(){s(t.ready)},ready(){s(".sugar-calendar-event-list-block").each(function(){new e(s(this))})}};return t})((document,window,jQuery)),SugarCalendarBlocks.EventList.init();
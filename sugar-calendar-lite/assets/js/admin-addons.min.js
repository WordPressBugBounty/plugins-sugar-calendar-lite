!function(i,c){"use strict";let u=window.SugarCalendar||{};u.Admin=u.Admin||{},u.Admin.Addons={init:function(){i(document).on("change",".sugar-calendar-addons-list-item .sugar-calendar-toggle-control input",function(a){if(a.preventDefault(),i(this).hasClass("disabled"))return!1;u.Admin.Addons.addonToggleNew(i(this))}),i(document).on("click",".sugar-calendar-addons-list-item button",function(a){if(a.preventDefault(),i(this).hasClass("disabled"))return!1;u.Admin.Addons.addonToggleNew(i(this))})},setAddonState(a,t,e,n,d){t={activate:"activate_addon",install:"install_addon",deactivate:"deactivate_addon",incompatible:"activate_addon"}[t];t&&i.post(c.ajax_url,{task:t,plugin:a,type:e},function(a){n(a)}).fail(function(a){d(a)})},addonToggleNew(d){const i=d.parents(".sugar-calendar-addons-list-item-footer"),s={active:"sugar-calendar-addons-list-item-footer-active",activating:"sugar-calendar-addons-list-item-footer-activating",incompatible:"sugar-calendar-addons-list-item-footer-incompatible",installed:"sugar-calendar-addons-list-item-footer-installed",missing:"sugar-calendar-addons-list-item-footer-missing",goToUrl:"sugar-calendar-addons-list-item-footer-go-to-url",withError:"sugar-calendar-addons-list-item-footer-with-error"};if(i.hasClass(s.goToUrl))window.open(d.attr("data-plugin"),"_blank");else{d.prop("disabled",!0);let e=d.is(":checked"),n;var a=i.attr("data-plugin");const t=i.attr("data-type"),r=d.parents(".sugar-calendar-addons-list-item"),l=this.getAddonState(i,s,d);function o(a){i.addClass(s.withError),"object"==typeof a.data?i.append(`<div class="sugar-calendar-addons-list-item-footer-error"><p>${"addon"===t?c.addon_error:c.plugin_error}</p></div>`):i.append(`<div class="sugar-calendar-addons-list-item-footer-error"><p>${a.data}</p></div>`),"install"===l?(e=!1,u.Admin.Addons.removeSpinnerFromButton(d)):"deactivate"===l?e=!0:"activate"===l&&(e=!1)}this.setAddonState(a,l,t,function(a){var t;a.success?(t=a,"install"===l?(n=s.active,e=!0,i.attr("data-plugin",t.data.basename),t.data.is_activated||(n=s.installed,e=!1),d.hide(),d=d.closest(".sugar-calendar-addons-list-item").find(".sugar-calendar-toggle-control input")):"activate"===l?(i.find(".sugar-calendar-addons-list-item-footer-settings-link").fadeIn(150),n=s.active,e=!0):"deactivate"===l&&(i.find(".sugar-calendar-addons-list-item-footer-settings-link").fadeOut(150),n=s.installed,e=!1),i.removeClass(s.active+" "+s.incompatible+" "+s.installed+" "+s.missing).addClass(n)):o(a),u.Admin.Addons.updateAddonButtonPropertiesAndUI(d,r,i,s,e)},function(){o({data:c.server_error}),u.Admin.Addons.updateAddonButtonPropertiesAndUI(d,r,i,s,e)})}},addSpinnerToButton(a){var t=a.width();a.data("original-text",a.html()),a.width(t).html('<i class="sugar-calendar-loading-spinner"></i>')},removeSpinnerFromButton(a){a.html(a.data("original-text"))},getAddonState(a,t,e){return a.hasClass(t.active)||a.hasClass(t.incompatible)?"deactivate":a.hasClass(t.installed)?"activate":a.hasClass(t.missing)?(this.addSpinnerToButton(e),"install"):""},updateAddonButtonPropertiesAndUI(a,t,e,n,d){a.prop("checked",d),a.prop("disabled",!1),a.siblings(".sugar-calendar-toggle-control-status").html(a.siblings(".sugar-calendar-toggle-control-status").data(d?"on":"off")),0<t.find(".sugar-calendar-addons-list-item-footer-error").length&&setTimeout(function(){e.removeClass(n.withError),t.find(".sugar-calendar-addons-list-item-footer-error").remove()},6e3)}},u.Admin.Addons.init(c),window.SugarCalendar=u}(jQuery,sugar_calendar_admin_addons);
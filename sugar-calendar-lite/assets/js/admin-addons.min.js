((i,c)=>{let u=window.SugarCalendar||{};u.Admin=u.Admin||{},u.Admin.Addons={init:function(){i(document).on("change",".sugar-calendar-addons-list-item .sugar-calendar-toggle-control input",function(a){if(a.preventDefault(),i(this).hasClass("disabled"))return!1;u.Admin.Addons.addonToggleNew(i(this))}),i(document).on("click",".sugar-calendar-addons-list-item button",function(a){if(a.preventDefault(),i(this).hasClass("disabled"))return!1;u.Admin.Addons.addonToggleNew(i(this))})},setAddonState(a,t,e,d,n){t={activate:"activate_addon",install:"install_addon",deactivate:"deactivate_addon",incompatible:"activate_addon"}[t];t&&i.post(c.ajax_url,{task:t,plugin:a,type:e},function(a){d(a)}).fail(function(a){n(a)})},addonToggleNew(s){let o=s.parents(".sugar-calendar-addons-list-item-footer"),r={active:"sugar-calendar-addons-list-item-footer-active",activating:"sugar-calendar-addons-list-item-footer-activating",incompatible:"sugar-calendar-addons-list-item-footer-incompatible",installed:"sugar-calendar-addons-list-item-footer-installed",missing:"sugar-calendar-addons-list-item-footer-missing",goToUrl:"sugar-calendar-addons-list-item-footer-go-to-url",withError:"sugar-calendar-addons-list-item-footer-with-error"};if(o.hasClass(r.goToUrl))window.open(s.attr("data-plugin"),"_blank");else{s.prop("disabled",!0);let e=s.is(":checked"),d;var a=o.attr("data-plugin");let t=o.attr("data-type"),n=s.parents(".sugar-calendar-addons-list-item"),i=this.getAddonState(o,r,s);function l(a){o.addClass(r.withError),"object"==typeof a.data?o.append(`<div class="sugar-calendar-addons-list-item-footer-error"><p>${"addon"===t?c.addon_error:c.plugin_error}</p></div>`):o.append(`<div class="sugar-calendar-addons-list-item-footer-error"><p>${a.data}</p></div>`),"install"===i?(e=!1,u.Admin.Addons.removeSpinnerFromButton(s)):"deactivate"===i?e=!0:"activate"===i&&(e=!1)}this.setAddonState(a,i,t,function(a){var t;a.success?(t=a,"install"===i?(d=r.active,e=!0,o.attr("data-plugin",t.data.basename),t.data.is_activated||(d=r.installed,e=!1),s.hide(),s=s.closest(".sugar-calendar-addons-list-item").find(".sugar-calendar-toggle-control input")):"activate"===i?(o.find(".sugar-calendar-addons-list-item-footer-settings-link").fadeIn(150),d=r.active,e=!0):"deactivate"===i&&(o.find(".sugar-calendar-addons-list-item-footer-settings-link").fadeOut(150),d=r.installed,e=!1),o.removeClass(r.active+" "+r.incompatible+" "+r.installed+" "+r.missing).addClass(d)):l(a),u.Admin.Addons.updateAddonButtonPropertiesAndUI(s,n,o,r,e)},function(){l({data:c.server_error}),u.Admin.Addons.updateAddonButtonPropertiesAndUI(s,n,o,r,e)})}},addSpinnerToButton(a){var t=a.width();a.data("original-text",a.html()),a.width(t).html('<i class="sugar-calendar-loading-spinner"></i>')},removeSpinnerFromButton(a){a.html(a.data("original-text"))},getAddonState(a,t,e){return a.hasClass(t.active)||a.hasClass(t.incompatible)?"deactivate":a.hasClass(t.installed)?"activate":a.hasClass(t.missing)?(this.addSpinnerToButton(e),"install"):""},updateAddonButtonPropertiesAndUI(a,t,e,d,n){a.prop("checked",n),a.prop("disabled",!1),a.siblings(".sugar-calendar-toggle-control-status").html(a.siblings(".sugar-calendar-toggle-control-status").data(n?"on":"off")),0<t.find(".sugar-calendar-addons-list-item-footer-error").length&&setTimeout(function(){e.removeClass(d.withError),t.find(".sugar-calendar-addons-list-item-footer-error").remove()},6e3)}},u.Admin.Addons.init(c),window.SugarCalendar=u})(jQuery,sugar_calendar_admin_addons);
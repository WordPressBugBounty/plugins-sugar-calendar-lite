(n=>{var e=window.SugarCalendar||{};e.Stripe=e.Stripe||{},e.Stripe={stripe:null,elements:null,paymentElement:null,$el:{$body:null,$modalPaymentFieldset:null,$checkoutForm:null,$errorContainer:null},init:function(){this.$el.$body=n("body"),this.$el.$modalPaymentFieldset=n("#sc-event-ticketing-modal-payment-fieldset"),sc_event_ticket_vars.publishable_key?this.setupStripe():this.$el.$modalPaymentFieldset.hide()},setupStripe:function(){this.stripe=Stripe(sc_event_ticket_vars.publishable_key),this.elements=this.stripe.elements({amount:parseInt(sc_event_ticket_stripe_vars.min_charge,10),currency:sc_event_ticket_stripe_vars.currency.toLowerCase(),mode:"payment"}),this.paymentElement=this.elements.create("payment"),this.paymentElement.mount("#sc-event-ticketing-card-element"),this.$el.$checkoutForm=n("#sc-event-ticketing-checkout"),this.$el.$errorContainer=n("#sc-event-ticketing-card-errors"),this.$el.$body.on("sc_et_gateway_ajax",this.performStripeProcess.bind(this))},performStripeProcess:function(){let t=this,e=n("#sc_et_nonce").val();e&&n.post(sc_event_ticket_vars.ajaxurl,{action:"sc_et_stripe_fetch_data",nonce:e,email:this.$el.$checkoutForm.find("#sc-event-ticketing-email").val(),first_name:this.$el.$checkoutForm.find("#sc-event-ticketing-first-name").val(),last_name:this.$el.$checkoutForm.find("#sc-event-ticketing-last-name").val(),event_id:this.$el.$checkoutForm.find("#sc_et_event_id").val(),quantity:this.$el.$checkoutForm.find("#sc_et_quantity").val()},function(e){e.success?e.data.is_free_event?t.$el.$checkoutForm.get(0).submit():t.confirmPayment(e.data):(t.hideSpinner(),t.$el.$errorContainer.append('<div class="sc-et-error alert alert-danger" role="alert">'+e.data.error_msg+"</div>"))})},async confirmPayment(e){this.elements.update({mode:"payment",amount:e.amount,currency:e.currency});var t=await this.elements.submit();return t.error?(this.hideSpinner(),this.$el.$errorContainer.append('<div class="sc-et-error alert alert-danger" role="alert">'+t.error.message+"</div>"),!1):(t=new URL(window.location.href),(e=await this.stripe.confirmPayment({elements:this.elements,clientSecret:e.payment_intent_client_secret,confirmParams:{return_url:t.toString()},redirect:"if_required"})).error?(this.hideSpinner(),this.$el.$errorContainer.append('<div class="sc-et-error alert alert-danger" role="alert">'+e.error.message+"</div>"),!1):"succeeded"===e.paymentIntent.status?(this.$el.$checkoutForm.append('<input type="hidden" name="sc_et_payment_intent" value="'+e.paymentIntent.id+'"/>'),this.$el.$checkoutForm.append('<input type="hidden" name="sc_et_payment_amount" value="'+e.paymentIntent.amount+'"/>'),this.$el.$checkoutForm.get(0).submit(),!0):void 0)},hideSpinner:function(){n("#sc-event-ticketing-modal .sc-et-spinner-border").hide()}},n(document).ready(e.Stripe.init.bind(e.Stripe)),window.SugarCalendar=e})(jQuery);
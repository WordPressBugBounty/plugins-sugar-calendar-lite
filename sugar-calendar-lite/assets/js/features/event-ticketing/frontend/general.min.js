window.sc_checkout_valid=!1,jQuery(document).ready(function(a){let t=a("#sc-event-ticketing-modal"),c=a("#sc-event-ticketing-quantity"),s=a("input#sc_et_event_id"),i=a("#sc-event-ticketing-checkout"),r=a(".sc-event-ticketing-attendee:first").clone();function o(t,e,n=!1){let i=parseInt(e);e=a(t);n&&e.find("input, select, textarea").val(""),e.find("input, select, textarea").each(function(){let t=a(this).attr("name"),e=a(this).attr("id");t&&(t=t.replace(/\[(\d+)\]/,"["+i+"]"),a(this).attr("name",t)),void 0!==e&&(e=e.replace(/(\d+)/,i),a(this).attr("id",e))}),e.find(".sc-event-ticketing-attendee__input-group__attendee-label").text("Attendee "+i),e.attr("attendee-key",i),e.attr("data-key",i)}function l(){let t=1;a(".sc-event-ticketing-attendee").each(function(){o(a(this),t),t++})}t.modal("handleUpdate"),t.on("show.bs.modal",function(){let e=parseInt(c.val());if(a(".sc-et-error",i).remove(),a.ajax({type:"POST",url:sc_event_ticket_vars.ajaxurl,data:{action:"sc_et_get_price",event_id:s.val(),quantity:e},dataType:"json",success:function(t){a("#sc-event-ticketing-checkout-total").html(t.data.data.price)}}),a("#sc-event-ticketing-quantity-span").text(e),1<e){a("#sc_et_quantity").val(e);let t=1;a(".sc-event-ticketing-attendee").not(":first").each(function(){!(++t>e)&&a(this).find("input").toArray().some(t=>""!==a(t).val())?(a(this).attr("attendee-key",t),a(this).attr("data-key",t)):a(this).remove()});for(let t=a(".sc-event-ticketing-attendee").length;t<e;t++){var n=r.clone();n.find(".sc-event-ticketing-remove-attendee").removeClass("sc-event-ticketing-control-inactive"),o(n,t+1,!0),n.appendTo("#sc-event-ticketing-modal-attendee-list")}}else a(".sc-event-ticketing-attendee").not(":first").remove();l()}),t.on("shown.bs.modal",function(){a("#sc-event-ticketing-first-name").focus()}),a("#sc-event-ticketing-modal-attendee-list").on("click",".sc-event-ticketing-add-attendee",function(){var t,n,e=a(this).parents(".sc-event-ticketing-attendee"),e=e.next(".sc-et-error").length?e.next(".sc-et-error"):e,i=a(".sc-event-ticketing-attendee").length;c.attr("max")<=i?alert(sc_event_ticket_vars.qty_limit_reached):(1===i&&a(".sc-event-ticketing-attendee-controls-group").find(".sc-event-ticketing-remove-attendee").removeClass("sc-event-ticketing-control-inactive"),t=a(".sc-event-ticketing-attendee:last").clone(),n=t.data("key"),t.attr("data-key",n+=1),t.find("input, select, textarea").val("").each(function(){var t=a(this).attr("name"),e=a(this).attr("id");t&&(t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]"),a(this).attr("name",t)),void 0!==e&&(e=e.replace(/(\d+)/,parseInt(n)),a(this).attr("id",e))}),t.insertAfter(e).find("input, textarea, select").filter(":visible").eq(0).focus(),l(),a("#sc_et_quantity, #sc-event-ticketing-quantity").val(i+1),a("#sc-event-ticketing-quantity-span").text(i+1),a.ajax({type:"POST",url:sc_event_ticket_vars.ajaxurl,data:{action:"sc_et_get_price",event_id:s.val(),quantity:a("input#sc_et_quantity").val()},dataType:"json",success:function(t){a("#sc-event-ticketing-checkout-total").html(t.data.data.price)}}))}),a("body").on("click",".sc-event-ticketing-remove-attendee",function(){var t=a(this).closest(".sc-event-ticketing-attendee"),e=a(".sc-event-ticketing-attendee").length,t=(1<e?(t.next(".sc-et-error").remove(),t.remove(),2===e&&a(".sc-event-ticketing-attendee-controls-group").find(".sc-event-ticketing-remove-attendee").addClass("sc-event-ticketing-control-inactive")):a("input",".sc-event-ticketing-attendee").val(""),l(),a(".sc-event-ticketing-attendee").length);a("#sc_et_quantity, #sc-event-ticketing-quantity").val(t),a("#sc-event-ticketing-quantity-span").text(t),a.ajax({type:"POST",url:sc_event_ticket_vars.ajaxurl,data:{action:"sc_et_get_price",event_id:a("input#sc_et_event_id").val(),quantity:t},dataType:"json",success:function(t){a("#sc-event-ticketing-checkout-total").html(t.data.data.price)}})}),a("#sc-event-ticketing-copy-billing-attendee").on("click",function(t){t.preventDefault(),a('input[name="attendees[1][first_name]"]',".sc-event-ticketing-attendee").val(a("#sc-event-ticketing-first-name").val()),a('input[name="attendees[1][last_name]"]',".sc-event-ticketing-attendee").val(a("#sc-event-ticketing-last-name").val()),a('input[name="attendees[1][email]"]',".sc-event-ticketing-attendee").val(a("#sc-event-ticketing-email").val())}),a("#sc-event-ticketing-cancel").on("click",function(){a("#sc-event-ticketing-modal .sc-et-spinner-border").hide()}),a("#sc-event-ticketing-purchase").on("click",function(){i.first().trigger("submit")}),i.on("submit",function(t){t.preventDefault();t=a(this);a("#sc-event-ticketing-modal .sc-et-spinner-border").show(),a(".sc-et-error",t).remove(),a.ajax({type:"POST",url:sc_event_ticket_vars.ajaxurl,dataType:"json",data:{action:"sc_et_validate_checkout",data:a(this).serialize()},success:function(t){t.success?a("body").trigger("sc_et_gateway_ajax",t):(a("#sc-event-ticketing-modal .sc-et-spinner-border").hide(),a.each(t.data.errors,function(t,e){a('<div class="sc-et-error alert alert-danger" role="alert">'+e.msg+"</div>").insertAfter(e.selector)}))}}).done(function(){}).fail(function(){}).always(function(){})}),c.on("change",function(){var t=a("#sc-event-ticketing-buy-button-woocommerce");let e=t.attr("href");t.length&&(e=t.attr("href").replace(/[0-9]+(?!.*[0-9])/,a(this).val())),t.attr("href",e)})});
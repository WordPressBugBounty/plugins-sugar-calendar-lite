let SCAdminImporters=window.SCAdminImporters||(m=>{let n={runtime_vars:{importer_slug:"",number_of_retries:0,total_number_to_import:{events:null,venues:null,speakers:null,tickets:null,orders:null,attendees:null,categories:null,tags:null},number_of_success_import:{events:0,venues:0,speakers:0,tickets:0,orders:0,attendees:0,categories:0,tags:0},last_migrated_context:null,ics_url:null,assets_url:null,doms:{$import_file_field:null,$import_file_info_span:null,$import_ics_url_field:null,$import_sc_btn:null,$import_ics_btn:null,$importer_logs:null,$importer_logs_status:null,$import_ics_form:null,$import_ics_summary:null},strings:{}},init(){m(n.ready)},ready(){n.cacheDom(),n.bindEvents(),n.setDefaults()},cacheDom(){n.runtime_vars.doms.$import_file_info_span=m("#sc-admin-tools-form-import-file-info"),n.runtime_vars.doms.$import_file_field=m("#sc-admin-tools-form-import"),n.runtime_vars.doms.$import_sc_btn=m("#sc-admin-tools-sc-import-btn"),n.runtime_vars.doms.$importer_logs=m("#sc-admin-importer-tec-logs"),n.runtime_vars.doms.$importer_logs_status=m("#sc-admin-importer-tec-logs__status")},setDefaults:function(){jconfirm.defaults={typeAnimated:!1,draggable:!1,animateFromElement:!1,boxWidth:"400px",useBootstrap:!1}},bindEvents(){m("#sc-admin-tools-import-btn").on("click",function(t){t.preventDefault(),n.runtime_vars.assets_url=sc_admin_importers.assets_url,n.runtime_vars.strings=sc_admin_importers.strings;let r=m(this);t=r.data("warning");t&&"1"===t.toString()?m.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",icon:n.getIcon("exclamation-circle-solid-orange"),title:sc_admin_importers.strings.heads_up,content:sc_admin_importers.strings.recurring_events_warning,buttons:{confirm:{text:sc_admin_importers.strings.yes,btnClass:"btn-confirm",keys:["enter"],action:function(){n.performImport(r)}},cancel:{text:sc_admin_importers.strings.cancel,btnClass:"btn-cancel"}}}):n.performImport(r)}),m("#sc-admin-tools-sc-import-btn").on("click",function(t){var r=m(this);r.find(".sc-admin-tools-sc-import-btn__text").addClass("sc-admin-tools__invisible"),r.append('<span class="sc-admin-tools-loading-spinner"></span>'),r.blur()}),n.runtime_vars.doms.$import_file_field.on("change",function(t){t.target.value&&(n.runtime_vars.doms.$import_file_info_span.text(t.target.value.split("\\").pop()),n.runtime_vars.doms.$import_sc_btn.removeClass("sc-admin-tools-disabled"))}),m("#sc-admin-tools-import-form-ics").on("submit",function(t){t.preventDefault(),n.runtime_vars.doms.$import_ics_form=m("form#sc-admin-tools-import-form-ics"),n.runtime_vars.doms.$import_ics_url_field=m(this).find("#sugar-calendar-setting-sc-admin-tools-ics-import-url"),n.runtime_vars.doms.$import_ics_btn=m(this).find("#sc-admin-tools-sc-import-ics-btn"),n.runtime_vars.doms.$import_ics_summary=m(".sc-admin-tools-import-summary-ics"),n.runtime_vars.strings=sc_admin_ics_importers.strings,n.runtime_vars.assets_url=sc_admin_ics_importers.assets_url,0<n.runtime_vars.doms.$import_ics_url_field.val().length&&(n.runtime_vars.ics_url=n.runtime_vars.doms.$import_ics_url_field.val(),n.runtime_vars.importer_slug="sugar-calendar-ics",n.toggleEnabledIcsButtonState(!1),n.runIcsImporter())})},toggleEnabledIcsButtonState(t){t?(n.runtime_vars.doms.$import_ics_btn.removeClass("sc-admin-tools__invisible"),n.runtime_vars.doms.$import_ics_btn.find(".sc-admin-tools-loading-spinner").remove(),n.runtime_vars.doms.$import_ics_btn.prop("disabled",!1)):(n.runtime_vars.doms.$import_ics_btn.addClass("sc-admin-tools__invisible"),n.runtime_vars.doms.$import_ics_btn.append('<span class="sc-admin-tools-loading-spinner"></span>'),n.runtime_vars.doms.$import_ics_btn.blur(),n.runtime_vars.doms.$import_ics_btn.prop("disabled",!0))},showIcsSummaryState(t){n.runtime_vars.doms.$import_ics_form.addClass("hidden"),n.runtime_vars.doms.$import_ics_summary.addClass("visible"),n.runtime_vars.doms.$import_ics_summary.find(".sc-admin-tools-import-summary__item-events-created").removeClass("hidden"),n.runtime_vars.doms.$import_ics_summary.find(".sc-admin-tools-import-summary__item-events-created .sc-admin-tools-import-summary-ics__item__value").text(t.created),n.runtime_vars.doms.$import_ics_summary.find(".sc-admin-tools-import-summary__item-events-updated").removeClass("hidden"),n.runtime_vars.doms.$import_ics_summary.find(".sc-admin-tools-import-summary__item-events-updated .sc-admin-tools-import-summary-ics__item__value").text(t.updated)},performImport(t){void 0!==t.data("importer")&&(n.runtime_vars.importer_slug=t.data("importer")),m("#sc-admin-importer-tec-status").text(sc_admin_importers.strings.migration_in_progress).show(),n.runImporter(),t.prop("disabled",!0),t.hide()},getIcon(t){return'"></i><img src="'+n.runtime_vars.assets_url+"images/icons/"+t+'.svg" style="width: 40px; height: 40px;" alt="Icon"><i class="'},runImporter(){m.post(sc_admin_importers.ajax_url,{nonce:sc_admin_importers.nonce,action:"sc_admin_importer",importer_slug:n.runtime_vars.importer_slug,total_number_to_import:n.runtime_vars.total_number_to_import},function(t){t.success?(n.runtime_vars.last_migrated_context||(n.runtime_vars.last_migrated_context=t.data.importer.process),n.runtime_vars.doms.$importer_logs_status.text(sc_admin_importers.strings[t.data.importer.status]),"complete"===t.data.importer.status?(m("#sc-admin-importer-tec-status").text(sc_admin_importers.strings.migration_completed),t.data.importer.error_html&&0<t.data.importer.error_html.length&&m("#sc-admin-importer-tec-logs").after(t.data.importer.error_html)):("hidden"!==t.data.importer.process&&(n.showLogs(t.data.importer.process,t.data.importer.progress,t.data.importer.total_number_to_import,t.data.importer.process_status),t.data.importer.attendees_count)&&n.showLogs("attendees",t.data.importer.attendees_count,t.data.importer.attendees_total_count,t.data.importer.process_status),n.runImporter())):n.retryAttempt()}).fail(function(t){n.retryAttempt()})},runIcsImporter(t=!1){m.post(sc_admin_ics_importers.ajax_url,{nonce:sc_admin_ics_importers.nonce,action:"sc_admin_importer",importer_slug:n.runtime_vars.importer_slug,total_number_to_import:n.runtime_vars.total_number_to_import,ics_url:n.runtime_vars.ics_url,clear_cache:t},function(t){if(t.success){var r=t.data.importer.status,s=t.data.importer.total_number_to_import,e=t.data.importer.progress,i=t.data.importer.message;switch(r){case"completed":n.showIcsSummaryState(e);break;case"error":m.alert({title:!1,content:i,titleClass:"sc-ics-importer-error-title",icon:n.getIcon("exclamation-circle-solid-orange"),type:"red",boxWidth:"400px",buttons:{confirm:{text:sc_admin_ics_importers.strings.ok,btnClass:"sugar-calendar-btn sugar-calendar-btn-lg sugar-calendar-btn-primary",keys:["enter"]}}});break;case"in_progress":return n.runtime_vars.total_number_to_import.events=s,void n.runIcsImporter()}n.toggleEnabledIcsButtonState(!0)}else n.retryAttempt(function(){n.runIcsImporter(!0)},function(){n.toggleEnabledIcsButtonState(!0)})}).fail(function(t){n.retryAttempt(function(){n.runIcsImporter(!0)},function(){n.toggleEnabledIcsButtonState(!0)})})},showLogs(r,s,e,t){n.runtime_vars.number_of_success_import[r]+=s;var s="sc-admin-importer-tec-logs__progress-"+r,i="sc-admin-importer-tec-logs__process-"+r,o=n.runtime_vars.number_of_success_import[r];if(0<m("#"+i).length)m("#"+s).text(o);else{n.runtime_vars.total_number_to_import[r]||(n.runtime_vars.total_number_to_import[r]=e);let t="";void 0!==e&&(t="/"+n.runtime_vars.total_number_to_import[r]),n.runtime_vars.doms.$importer_logs.append('<div id="'+i+'" class="sc-admin-tools-migrate-context"><div class="sc-admin-tools-migrate-context__status"><div class="sc-admin-tools-migrate-context__status__in-progress"></div></div><div class="sc-admin-tools-migrate-context__info">'+sc_admin_importers.strings["migrated_"+r]+' <span id="'+s+'">'+o+"</span>"+t+"</div></div>")}(o>=n.runtime_vars.total_number_to_import[r]||"complete"===t)&&m("#sc-admin-importer-tec-logs__process-"+r).find(".sc-admin-tools-migrate-context__status").html('<div class="sc-admin-tools-migrate-context__status__complete"></div>')},retryAttempt(t,r){5<=n.runtime_vars.number_of_retries?(alert(n.runtime_vars.strings.migration_failed),r&&r()):(++n.runtime_vars.number_of_retries,t?t():n.runImporter())}};return n})((document,window,jQuery));SCAdminImporters.init();